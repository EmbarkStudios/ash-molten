language: rust

rust:
  - stable
matrix:
  fast_finish: true
  include:
    - os: osx
      osx_image: xcode11.1

before_script:
  - rustup component add rustfmt clippy

env:
  global:
    - RUST_BACKTRACE=1

script:
  # Ensure everything has been rustfmt'ed
  - cargo fmt -- --check
  # Download in a separate step to separate
  # building from fetching dependencies
  - cargo fetch
  # Build everything in a separate step to make a
  # clear distinction between building and testing
  - cargo test --no-run -vv
  - cargo test --no-fail-fast -vv
  # Because rust isn't brutal enough itself
  # We need to run it after the build, otherwise clippy will try to build MoltenVK and travis will time out
  - cargo clippy -- -D warnings
